version: 1.2.0
services:
  - mysql
  - php:
        version: 7.1
variables:
  global:
cde-databases:
  - ucsfpa8
events:
  build:
    steps:
      - setup:
          type: script
          script:
            - echo "completed"
  post-deploy:
    steps:
      # Deploy the build artifact to a Cloud on-demand environment.
      - deploy:
          script:
            - pipelines-deploy
            - pipelines-sync-dbs ucsfpa8
      - cleanup:
          type: script
          script:
            - cd docroot
            - drush8 cr
            - drush8 en stage_file_proxy
            - drush8 config-set stage_file_proxy.settings origin "https://www.ucsf.edu"

  # When a GitHub pull request is merged, this deletes the corresponding ODE.
  pr-merged:
    steps:
      - deploy:
          script:
            - pipelines-deploy

  # When a GitHub pull request is closed, this deletes the corresponding ODE.
  pr-closed:
    steps:
      - deploy:
          script:
            - pipelines-deploy
