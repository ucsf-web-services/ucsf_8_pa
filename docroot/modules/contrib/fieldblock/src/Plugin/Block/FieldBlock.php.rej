***************
*** 18,23 ****
  use Drupal\Core\Field\FormatterPluginManager;
  use Drupal\Core\Form\FormHelper;
  use Drupal\Core\Form\FormStateInterface;
  use Drupal\Core\Plugin\ContainerFactoryPluginInterface;
  use Drupal\Core\Routing\RouteMatchInterface;
  use Drupal\Core\Session\AccountInterface;
--- 18,24 ----
  use Drupal\Core\Field\FormatterPluginManager;
  use Drupal\Core\Form\FormHelper;
  use Drupal\Core\Form\FormStateInterface;
+ use Drupal\Core\Form\SubformStateInterface;
  use Drupal\Core\Plugin\ContainerFactoryPluginInterface;
  use Drupal\Core\Routing\RouteMatchInterface;
  use Drupal\Core\Session\AccountInterface;
***************
*** 155,160 ****
     * {@inheritdoc}
     */
    public function blockForm($form, FormStateInterface $form_state) {
      $form['label_from_field'] = [
        '#title' => $this->t('Use field label as block title'),
        '#type' => 'checkbox',
--- 156,171 ----
     * {@inheritdoc}
     */
    public function blockForm($form, FormStateInterface $form_state) {
+     // This method receives a sub form state instead of the full form state.
+     // There is an ongoing discussion around this which could result in the
+     // passed form state going back to a full form state. In order to prevent
+     // future breakage because of a core update we'll just check which type of
+     // FormStateInterface we've been passed and act accordingly.
+     // @See https://www.drupal.org/node/2798261
+     if ($form_state instanceof SubformStateInterface) {
+       $form_state = $form_state->getCompleteFormState();
+     }
+ 
      $form['label_from_field'] = [
        '#title' => $this->t('Use field label as block title'),
        '#type' => 'checkbox',
