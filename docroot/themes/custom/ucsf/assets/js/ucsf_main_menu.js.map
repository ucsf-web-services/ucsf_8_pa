{"version":3,"sources":["ucsf_main_menu.js"],"names":["$","desktopMenu","menuButton","each","on","event","preventDefault","setAria","trigger","value","attr","e","$this","$parent","parent","$otherPanels","siblings","toggleClass","removeClass","find","hasClass","parents","focus","stopPropagation","$otherSubmenues","getMenuPanelHeight","dropdown","resizeMenuPanel","self","height","mainHeight","childMenu","totalHeight","childHeight","clientHeight","$innerMenu","children","innerMenuHeight","length","$innerMenuChild","css","resizeTimer","window","clearTimeout","setTimeout","keyboardAccessibleSearchForm","$searchToggle","$search","click","document","activeElement","body","closest","desktopDetect","mql","matches","watchResize","matchMedia","addListener","jQuery","Drupal","behaviors","mainMenuSearchFilter","attach","context","settings","$form","submit","option","val"],"mappings":"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","file":"ucsf_main_menu.js","sourcesContent":["/**\n * Main navigation, Desktop.\n */\n (($ => {\n  // Wait for the document to be ready.\n  $(() => {\n    const desktopMenu = () => {\n      const menuButton = $('main-nav__toggle, .main-submenu__toggle, .menu-item-close');\n      menuButton.each(function () {\n        $(this).on('click', function (event) {\n          event.preventDefault();\n        });\n      });\n\n      /**\n       * Set aria-expanded attribute value on element that triggers the submenu visibility\n       * @param {jQuery Object} trigger\n       * @param {String} value\n       */\n      const setAria = ( trigger, value ) => {\n        trigger.attr('aria-expanded', value);\n      }\n\n      // Toggle open the sub panels on main nav button click.\n      $('.main-nav__toggle').on('click touchstart', function (e) {\n        const $this = $(this);\n        const $parent = $this.parent('.main-nav__submenu-wrapper, .search');\n        const $otherPanels = $parent.siblings();\n        $parent.toggleClass('menu-item-open');\n        $otherPanels.removeClass('menu-item-open');\n        // close previously opened level-1 submenues\n        $otherPanels.find('.main-submenu__toggle').parent('.menu-item--expanded').removeClass('menu-item-open');\n\n        // Set aria attribute based on panel visibility.\n        if ($parent.hasClass('menu-item-open')) {\n          setAria($this, 'true');\n          setAria($('.menu-item-close'), 'true');\n          // reset area of previously opened panels.\n          $otherPanels.find('.main-nav__toggle').attr('aria-expanded', false);\n        } else {\n          setAria($this, 'false');\n          setAria($('.menu-item-close'), 'false');\n        }\n      });\n\n      // The \"x\" button inside menu panel.\n      $('.menu-item-close').on('click touchstart', function (e) {\n        const $this = $(this);\n        const $parent = $this.parents('.main-nav__submenu-wrapper');\n        $parent.removeClass('menu-item-open');\n        $parent.find('.main-nav__toggle').focus();\n         // close previously opened level-1 submenues\n        $('.main-submenu__toggle').parent('.menu-item--expanded').removeClass('menu-item-open');\n        // Set aria attribute.\n        setAria($this, 'false');\n        // reset area of main submenu toggle.\n        setAria($('.main-nav__toggle'), 'false');\n      });\n\n\n      // Toggle submenu open / close on btn click\n      $('.main-submenu__toggle').on('click touchstart', function (e) {\n        e.stopPropagation();\n        const $this = $(this);\n        const $parent = $this.parent('.menu-item--expanded');\n        const $otherSubmenues = $parent.siblings();\n\n        $parent.toggleClass('menu-item-open');\n        $otherSubmenues.removeClass('menu-item-open');\n\n        // Set aria attribute based on panel visibility.\n        if ($parent.hasClass('menu-item-open')) {\n          setAria($this, 'true');\n          // reset area of previously opened submenues.\n          $otherSubmenues.find('.main-nav__toggle').attr('aria-expanded', false);\n        } else {\n          setAria($this, 'false');\n        }\n      });\n    }\n\n    const getMenuPanelHeight = () => {\n      // Set dropdown heights based on the content within.\n      var dropdown = $('[data-level=\"level-0\"]');\n      const resizeMenuPanel = () => {\n        dropdown.each(function () {\n          var self = $(this);\n          // reset the height on screen resize\n          self.height('auto');\n          var mainHeight = self.height();\n          var childMenu = self.find('[data-level=\"level-1\"]');\n          var totalHeight = mainHeight;\n          var childHeight = 0;\n\n          childMenu.each(function () {\n            childHeight = $(this)[0].clientHeight;\n            if (childHeight + 48 >= mainHeight) {\n              totalHeight = childHeight;\n            }\n          });\n\n          self.height(totalHeight + 68);\n\n          // Get the height of the ul .main-submenu__menu\n          const $innerMenu = self.children('.main-submenu__menu');\n          const innerMenuHeight = $innerMenu.height();\n\n          // Set the min-height of each of the ul's child data-level=\"level-1\"\n          // so that inner menu panel has enough height to hover from parent link to it\n          if ($innerMenu.length !== 0) {\n            var $innerMenuChild = $innerMenu.find('[data-level=\"level-1\"]');\n            $innerMenuChild.css('min-height', innerMenuHeight + 'px');\n          }\n        });\n      };\n\n      // Select and loop the container element of the elements you want to equalise\n      resizeMenuPanel();\n\n      // At the end of a screen resize.\n      let resizeTimer = null;\n      $(window).on('resize', () => {\n        clearTimeout(resizeTimer);\n        resizeTimer = setTimeout(() => {\n          // resizing has \"stopped\".\n          resizeMenuPanel();\n        }, 250);\n      });\n    }\n\n    const keyboardAccessibleSearchForm = () => {\n      const $searchToggle = $('.menu-item-search-menu');\n      const $search = $('.search');\n\n      /**\n       * Set aria-expanded attribute value on element that triggers the submenu visibility\n       * @param {jQuery Object} trigger\n       * @param {String} value\n       */\n        const setAria = ( trigger, value ) => {\n        trigger.attr('aria-expanded', value);\n      }\n\n      $searchToggle.click(function (e) {\n        e.preventDefault();\n        if ($search.hasClass('menu-item-open')) {\n          $('.main-nav__search .home-search__form-input').focus();\n        }\n      });\n\n      //Search form closes when tabbing away.\n      $search.on('focusout', function () {\n        //Wait and only remove classes if newly focused element is outside the search form\n        setTimeout(function () {\n          // When browser cant find activeElement it returns <body> or null\n          // which triggers the false positive for document.activeElement.closest('.main-nav__search') === null\n          // Clicking on the label inside search box caused this behavior, since labels don't receive focus\n          if (\n            document.activeElement === document.body ||\n            document.activeElement === null\n          ) {\n            return;\n          }\n\n          // Close the search box if the currently focused el.\n          //  is not inside the search box\n          if (\n            document.activeElement.closest('.main-nav__search') === null\n          ) {\n            $search.removeClass('menu-item-open');\n            setAria($searchToggle, false)\n          }\n          // delay needs to be at least 150 to avoid a race condition with $searchToggle.toggleClass('active');\n        }, 150);\n      });\n    }\n\n    /**\n     * Run code if medium/desktop display has been detected.\n     *\n     * @param {MediaQueryList} mql\n     */\n     const desktopDetect = (mql) => {\n      // Desktop\n      if (mql.matches) {\n        desktopMenu();\n        getMenuPanelHeight();\n        keyboardAccessibleSearchForm();\n      } else {\n        return;\n      }\n    }\n\n    /**\n     * Watch for when the screen resizes horizontally from mobile to desktop.\n     */\n    const watchResize = () => {\n      // Use MatchMedia to ensure that desktop related code runs only on desktop\n      const mql = matchMedia('(min-width: 850px)');\n      // Detect Desktop on page load.\n      desktopDetect(mql);\n      // Watch to see if the page size changes.\n      mql.addListener(desktopDetect);\n    }\n\n    // Initialize.\n    watchResize();\n  });\n\n\n}))(jQuery);\n\n(function ($, window) {\n  // Main menu search form redirect\n  Drupal.behaviors.mainMenuSearchFilter = {\n    attach: function attach(context, settings) {\n      // Selector for the form.\n      const $form = $('.search__form', context);\n      $form.submit(function () {\n        const $this = $(this);\n        // Find checked radio button inside the form and get it's value.\n        const option = $this.find('.search-filter__radio:checked').val();\n        // If value is \"News\" redirect to news filter search.\n        if (option === 'News') {\n          $this.attr('action', '/news/filter');\n          $this.find('.home-search__form-input').attr('name', 'combine');\n        }\n\n        return true;\n      });\n    },\n  };\n})(jQuery, window);\n"]}