{"version":3,"sources":["ucsf_multirange-slider.js"],"names":["$","$publicationRange","$selectMin","$selectMax","minRange","parseInt","find","text","maxRange","getCurrentMinAfterOverlap","minValue","maxValue","minLimit","updateSlider","selectMinOption","selectMaxOption","isNaN","slider","createSlider","currentMinValue","currentMaxValue","range","min","max","step","values","animate","slide","event","ui","stop","$selectMinOptionVal","val","$selectMaxOptionVal","undefined","$handleMin","first","addClass","attr","yearLabelMin","append","$handleMax","last","yearLabelMax","desktopDetect","mql","matches","empty","e","watchResize","matchMedia","addListener","jQuery"],"mappings":"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","file":"ucsf_multirange-slider.js","sourcesContent":["(($ => {\n  // Wait for the document to be ready.\n  $(() => {\n    const $publicationRange = $('.publication-range');\n\n    const $selectMin = $('#edit-field-date-and-time-value-1');\n    const $selectMax = $('#edit-field-date-and-time-value-2');\n\n    // Min and Max year range.\n    const minRange = parseInt($selectMin.find('option:nth-child(2)').text());\n    const maxRange = parseInt($selectMax.find('option:nth-child(2)').text());\n\n    /**\n     * Get the current minimum value after preventing min/max from overlapping.\n     *\n     * @param {number} minValue The minimum value of the current slider.\n     * @param {number} maxValue The maximum value of the current slider.\n     * @param {number} minLimit The lowest the minimum value can go.\n     *   Defaults to the minimum range allowed in the slider.\n     */\n    const getCurrentMinAfterOverlap = (minValue, maxValue, minLimit = minRange) => {\n      if (minValue >= maxValue) {\n        if (minValue <= minLimit) {\n          minValue = minLimit\n        } else {\n          minValue -= 1;\n        }\n      }\n\n      return minValue\n    }\n\n    /**\n     * Sync multirange slider with filter data from dropdowns.\n     */\n    const updateSlider = () => {\n      // Find what dropdown values are selected\n      let selectMinOption = parseInt($selectMin.find(':selected').text());\n      let selectMaxOption = parseInt($selectMax.find(':selected').text());\n\n      // Sanitize.\n      if (isNaN(selectMinOption)) {\n        selectMinOption = minRange;\n      };\n      if (isNaN(selectMaxOption)) {\n        selectMaxOption = maxRange;\n      };\n\n      selectMinOption = getCurrentMinAfterOverlap(selectMinOption, selectMaxOption)\n\n      // Provide selected values to the multirange slider\n      $publicationRange.slider('values', 0, selectMinOption);\n      $publicationRange.slider('values', 1, selectMaxOption);\n\n      // Update floating labels for multirange slider handles\n      $('.min-limit').text(selectMinOption);\n      $('.max-limit').text(selectMaxOption);\n    };\n\n    /**\n     * Create the jQuery UI Range Slider\n     *\n     * https://api.jqueryui.com/slider/#event-slide\n     */\n    const createSlider = () => {\n      // Default values for min and max publication year handles\n      let currentMinValue = getCurrentMinAfterOverlap(minRange, maxRange);\n      let currentMaxValue = maxRange;\n\n      // JQUERY SLIDER UI OBJECT\n      $publicationRange.slider({\n        range: true,\n        min: minRange,\n        max: maxRange,\n        step: 1,\n        values: [currentMinValue, currentMaxValue],\n        animate: \"fast\",\n\n        // Triggered on every mouse move during slide\n        slide: function(event, ui) {\n          currentMinValue = ui.values[0];\n          currentMaxValue = ui.values[1];\n\n          if (currentMinValue >= currentMaxValue) {\n            return false;\n          }\n\n          // Update floating labels for handles\n          $('.min-limit').text(currentMinValue);\n          $('.max-limit').text(currentMaxValue);\n        },\n\n        stop: function(event, ui) {\n          currentMinValue = ui.values[0];\n          currentMaxValue = ui.values[1];\n\n          // Find out what the select value of a chosen date is.\n          let $selectMinOptionVal = $selectMin.find(`option:contains(${currentMinValue})`).val();\n          let $selectMaxOptionVal = $selectMax.find(`option:contains(${currentMaxValue})`).val();\n\n          // Sanitize.\n          if ($selectMinOptionVal === undefined) {\n            $selectMinOptionVal = 'All'\n          }\n          if ($selectMaxOptionVal === undefined) {\n            $selectMaxOptionVal = 'All'\n          }\n\n          // Set the selected option.\n          $selectMin.val($selectMinOptionVal);\n          $selectMax.val($selectMaxOptionVal);\n        },\n      });\n\n      // Minimum Publication Year handle\n      const $handleMin = $('.ui-slider-handle').first();\n      $handleMin.addClass('ui-slider-handle--min')\n      $handleMin.attr({\n        'data-testid':'publication-year-min',\n      });\n\n      // Create floating label for Minimum Publication Year handle\n      const yearLabelMin =\n        `<span class='visually-hidden'>Minimum year of publication:</span>\n        <span class='ui-slider__handle-label min-limit'></span>`;\n      $handleMin.append(yearLabelMin);\n\n\n      // Maximum Publication Year handle\n      const $handleMax = $('.ui-slider-handle').last();\n      $handleMax.addClass('ui-slider-handle--max')\n      $handleMax.attr({\n        'data-testid':'publication-year-max',\n      });\n\n      // Create floating label for Maximum Publication Year handle\n      const yearLabelMax =\n        `<span class='visually-hidden'>Maximum year of publication:</span>\n        <span class='ui-slider__handle-label max-limit'></span>`;\n      $handleMax.append(yearLabelMax);\n\n      updateSlider();\n    };\n\n    /**\n     * Initialize the range slider if a desktop display has been detected.\n     *\n     * @param {MediaQueryList} mql\n     */\n    const desktopDetect = (mql) => {\n      // Desktop\n      if (mql.matches) {\n        createSlider();\n      } else {\n        // Remove the range slider in mobile.\n        try {\n          $publicationRange.slider('destroy').empty();\n        } catch (e) {}\n      }\n    }\n\n    /**\n     * Watch for when the screen resizes horizontally from mobile to desktop.\n     */\n    const watchResize = () => {\n      // Use MatchMedia to ensure that the range slider only happens in desktop.\n      const mql = matchMedia('(min-width: 1027px)');\n      // Detect Desktop on page load.\n      desktopDetect(mql);\n      // Watch to see if the page size changes.\n      mql.addListener(desktopDetect);\n    }\n\n    // Initialize.\n    watchResize();\n\n  });\n}))(jQuery);\n"]}