{"version":3,"sources":["ucsf_multirange-slider.js"],"names":["$","$publicationRange","$selectMin","$selectMax","minRange","parseInt","find","text","maxRange","getCurrentMinAfterOverlap","minValue","maxValue","minLimit","positionLabelHorizontally","$labelMin","$labelMax","$handleMin","$handleMax","toString","addClass","hasClass","removeClass","updateSlider","selectMinOption","selectMaxOption","isNaN","slider","createSlider","currentMinValue","currentMaxValue","range","min","max","step","values","animate","slide","event","ui","stop","$selectMinOptionVal","val","$selectMaxOptionVal","undefined","first","attr","yearLabelMin","append","last","yearLabelMax","trackLabel","desktopDetect","mql","matches","empty","e","watchResize","matchMedia","addListener","jQuery"],"mappings":"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","file":"ucsf_multirange-slider.js","sourcesContent":["(($ => {\n  // Wait for the document to be ready.\n  $(() => {\n    const $publicationRange = $('.publication-range');\n\n    const $selectMin = $('#edit-field-date-and-time-value-1');\n    const $selectMax = $('#edit-field-date-and-time-value-2');\n\n    // Min and Max year range.\n    const minRange = parseInt($selectMin.find('option:nth-child(2)').text());\n    const maxRange = parseInt($selectMax.find('option:nth-child(2)').text());\n\n    /**\n     * Get the current minimum value after preventing min/max from overlapping.\n     *\n     * @param {number} minValue The minimum value of the current slider.\n     * @param {number} maxValue The maximum value of the current slider.\n     * @param {number} minLimit The lowest the minimum value can go.\n     *   Defaults to the minimum range allowed in the slider.\n     */\n    const getCurrentMinAfterOverlap = (minValue, maxValue, minLimit = minRange) => {\n      if (minValue >= maxValue) {\n        if (minValue <= minLimit) {\n          minValue = minLimit\n        } else {\n          minValue -= 1;\n        }\n      }\n\n      return minValue\n    }\n\n    /**\n     * If min/max handle is at left/right edge, don't center text inside floating label\n     */\n    const positionLabelHorizontally = () => {\n      const $labelMin = $('.min-limit');\n      const $labelMax = $('.max-limit');\n\n      const $handleMin = $('.ui-slider-handle--min');\n      const $handleMax = $('.ui-slider-handle--max');\n\n\n      if ($labelMin.text() === minRange.toString()) {\n        $handleMin.addClass('ui-slider-handle--snap-left')\n      } else {\n        if ($handleMin.hasClass('ui-slider-handle--snap-left')) {\n          $handleMin.removeClass('ui-slider-handle--snap-left')\n        }\n        return\n      }\n\n      if ($labelMax.text() === maxRange.toString()) {\n        $handleMax.addClass('ui-slider-handle--snap-right')\n      } else {\n        if ($handleMax.hasClass('ui-slider-handle--snap-right')) {\n          $handleMax.removeClass('ui-slider-handle--snap-right')\n        }\n        return\n      }\n    }\n\n    /**\n     * Sync multirange slider with filter data from dropdowns.\n     */\n    const updateSlider = () => {\n      // Find what dropdown values are selected\n      let selectMinOption = parseInt($selectMin.find(':selected').text());\n      let selectMaxOption = parseInt($selectMax.find(':selected').text());\n\n      // Sanitize.\n      if (isNaN(selectMinOption)) {\n        selectMinOption = minRange;\n      };\n      if (isNaN(selectMaxOption)) {\n        selectMaxOption = maxRange;\n      };\n\n      selectMinOption = getCurrentMinAfterOverlap(selectMinOption, selectMaxOption)\n\n      // Provide selected values to the multirange slider\n      $publicationRange.slider('values', 0, selectMinOption);\n      $publicationRange.slider('values', 1, selectMaxOption);\n\n      // Update floating labels for multirange slider handles\n      $('.min-limit').text(selectMinOption);\n      $('.max-limit').text(selectMaxOption);\n      positionLabelHorizontally();\n    };\n\n    /**\n     * Create the jQuery UI Range Slider\n     *\n     * https://api.jqueryui.com/slider/#event-slide\n     */\n    const createSlider = () => {\n      // Default values for min and max publication year handles\n      let currentMinValue = getCurrentMinAfterOverlap(minRange, maxRange);\n      let currentMaxValue = maxRange;\n\n      // JQUERY SLIDER UI OBJECT\n      $publicationRange.slider({\n        range: true,\n        min: minRange,\n        max: maxRange,\n        step: 1,\n        values: [currentMinValue, currentMaxValue],\n        animate: \"fast\",\n\n        // Triggered on every mouse move during slide\n        slide: function(event, ui) {\n          currentMinValue = ui.values[0];\n          currentMaxValue = ui.values[1];\n\n          if (currentMinValue >= currentMaxValue) {\n            return false;\n          }\n\n          // Update floating labels for handles\n          $('.min-limit').text(currentMinValue);\n          $('.max-limit').text(currentMaxValue);\n          positionLabelHorizontally();\n        },\n\n        stop: function(event, ui) {\n          currentMinValue = ui.values[0];\n          currentMaxValue = ui.values[1];\n\n          // Find out what the select value of a chosen date is.\n          let $selectMinOptionVal = $selectMin.find(`option:contains(${currentMinValue})`).val();\n          let $selectMaxOptionVal = $selectMax.find(`option:contains(${currentMaxValue})`).val();\n\n          // Sanitize.\n          if ($selectMinOptionVal === undefined) {\n            $selectMinOptionVal = 'All'\n          }\n          if ($selectMaxOptionVal === undefined) {\n            $selectMaxOptionVal = 'All'\n          }\n\n          // Set the selected option.\n          $selectMin.val($selectMinOptionVal);\n          $selectMax.val($selectMaxOptionVal);\n        },\n      });\n\n      // Minimum Publication Year handle\n      const $handleMin = $('.ui-slider-handle').first();\n      $handleMin.addClass('ui-slider-handle--min')\n      $handleMin.attr({\n        'data-testid':'puplication-year-min',\n      });\n\n      // Create floating label for Minimum Publication Year handle\n      const yearLabelMin =\n        `<span class='visually-hidden'>Minimum year of publication:</span>\n        <span class='ui-slider__handle-label min-limit'></span>`;\n      $handleMin.append(yearLabelMin);\n\n\n      // Maximum Publication Year handle\n      const $handleMax = $('.ui-slider-handle').last();\n      $handleMax.addClass('ui-slider-handle--max')\n      $handleMax.attr({\n        'data-testid':'puplication-year-max',\n      });\n\n      // Create floating label for Maximum Publication Year handle\n      const yearLabelMax =\n        `<span class='visually-hidden'>Maximum year of publication:</span>\n        <span class='ui-slider__handle-label max-limit'></span>`;\n      $handleMax.append(yearLabelMax);\n\n      // TRACK FOR RANGE SLIDER\n      // Label for the range track\n      const trackLabel =\n        `<p class='ui-slider__track-label'>\n          <span class='visually-hidden'>Available publication years range from</span>\n          <span>${minRange}</span>\n          <span class='visually-hidden'>to</span>\n          <span>${maxRange}</span>\n        </p>`;\n      $('.publication-range').append(trackLabel);\n\n      updateSlider();\n    };\n\n    /**\n     * Initialize the range slider if a desktop display has been detected.\n     *\n     * @param {MediaQueryList} mql\n     */\n    const desktopDetect = (mql) => {\n      // Desktop\n      if (mql.matches) {\n        createSlider();\n      } else {\n        // Remove the range slider in mobile.\n        try {\n          $publicationRange.slider('destroy').empty();\n        } catch (e) {}\n      }\n    }\n\n    /**\n     * Watch for when the screen resizes horizontally from mobile to desktop.\n     */\n    const watchResize = () => {\n      // Use MatchMedia to ensure that the range slider only happens in desktop.\n      const mql = matchMedia('(min-width: 1027px)');\n      // Detect Desktop on page load.\n      desktopDetect(mql);\n      // Watch to see if the page size changes.\n      mql.addListener(desktopDetect);\n    }\n\n    // Initialize.\n    watchResize();\n\n  });\n}))(jQuery);\n"]}