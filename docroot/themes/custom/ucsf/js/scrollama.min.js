"use strict";

var _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"]) _i["return"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError("Invalid attempt to destructure non-iterable instance"); } }; }();

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj; };

!function (e, t) {
  "object" == (typeof exports === "undefined" ? "undefined" : _typeof(exports)) && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : (e = e || self).scrollama = t();
}(undefined, function () {
  "use strict";
  function $(_ref) {
    var e = _ref.id,
        t = _ref.step,
        n = _ref.marginTop;
    var o = t.index,
        t = t.height,
        o = "scrollama__debug-step--" + e + "-" + o;
    var r = document.querySelector("." + o);r = r || function (e) {
      var t = document.createElement("div");t.className = "scrollama__debug-step " + e, t.style.position = "fixed", t.style.left = "0", t.style.width = "100%", t.style.zIndex = "9999", t.style.borderTop = "2px solid black", t.style.borderBottom = "2px solid black";var n = document.createElement("p");return n.style.position = "absolute", n.style.left = "0", n.style.height = "1px", n.style.width = "100%", n.style.borderTop = "1px dashed black", t.appendChild(n), document.body.appendChild(t), t;
    }(o), r.style.top = -1 * n + "px", r.style.height = t + "px", r.querySelector("p").style.top = t / 2 + "px";
  }function S(e) {
    console.error("scrollama error: " + e);
  }function k(e) {
    return +e.getAttribute("data-scrollama-index");
  }function M(e) {
    if ("string" == typeof e && 0 < e.indexOf("px")) {
      var t = +e.replace("px", "");return isNaN(t) ? (err("offset value must be in 'px' format. Fallback to 0.5."), { format: "percent", value: .5 }) : { format: "pixels", value: t };
    }return "number" != typeof e && isNaN(+e) ? null : (1 < e && err("offset value is greater than 1. Fallback to 1."), e < 0 && err("offset value is lower than 0. Fallback to 0."), { format: "percent", value: Math.min(Math.max(0, e), 1) });
  }var e = 0,
      t = 0,
      O = void 0;function q() {
    e !== window.pageYOffset && (e = window.pageYOffset, e > t ? O = "down" : e < t && (O = "up"), t = e);
  }return document.addEventListener("scroll", q), function () {
    var r = {},
        s = function () {
      var t = "abcdefghijklmnopqrstuvwxyz",
          e = Date.now();var n = [];for (var _e = 0; _e < 6; _e += 1) {
        var o = t[Math.floor(Math.random() * t.length)];n.push(o);
      }return "" + n.join("") + e;
    }(),
        a = [],
        c = void 0,
        f = 0,
        t = !1,
        l = !1,
        p = !1,
        u = !1,
        o = [];function d() {
      r = { stepEnter: function stepEnter() {}, stepExit: function stepExit() {}, stepProgress: function stepProgress() {} }, o = [];
    }function h(e) {
      e && !t && w(), !e && t && v(), t = e;
    }function i(e, t) {
      var n = k(e);var o = a[n];void 0 !== t && (o.progress = t);t = { element: e, index: n, progress: t, direction: O };"enter" === o.state && r.stepProgress(t);
    }function n(_ref2) {
      var _ref3 = _slicedToArray(_ref2, 1),
          e = _ref3[0];

      var t = k(e.target);var n = a[t];e = e.target.offsetHeight;e !== n.height && (n.height = e, x(n), y(n), b(n));
    }function g(_ref4) {
      var _ref5 = _slicedToArray(_ref4, 1),
          e = _ref5[0];

      q();var t = e.isIntersecting,
          e = e.target;
      (t ? function (e) {
        var t = k(e);var n = a[t];e = { element: e, index: t, direction: O }, n.direction = O, n.state = "enter", o[t] || r.stepEnter(e), u && (o[t] = !0);
      } : function (e) {
        var t = k(e);var n = a[t];n.state && (t = { element: e, index: t, direction: O }, l && ("down" === O && n.progress < 1 ? i(e, 1) : "up" === O && 0 < n.progress && i(e, 0)), n.direction = O, n.state = "exit", r.stepExit(t));
      })(e);
    }function m(_ref6) {
      var _ref7 = _slicedToArray(_ref6, 1),
          e = _ref7[0];

      var t = k(e.target),
          n = a[t],
          o = e.isIntersecting,
          t = e.intersectionRatio,
          e = e.target;o && "enter" === n.state && i(e, t);
    }function x(_ref8) {
      var t = _ref8.observers;
      Object.keys(t).map(function (e) {
        t[e].disconnect();
      });
    }function v() {
      a.forEach(x);
    }function b(e) {
      var t = new ResizeObserver(n);t.observe(e.node), e.observers.resize = t;
    }function y(e) {
      var t = window.innerHeight,
          n = e.offset || c,
          o = "pixels" === n.format ? 1 : t,
          n = n.value * o,
          o = e.height / 2 - n,
          n = e.height / 2 - (t - n);var r = new IntersectionObserver(g, { rootMargin: o + "px 0px " + n + "px 0px", threshold: .5 });r.observe(e.node), e.observers.step = r, p && $({ id: s, step: e, marginTop: o, marginBottom: n });
    }function e(e) {
      var t = window.innerHeight,
          n = e.offset || c,
          o = "pixels" === n.format ? 1 : t,
          o = n.value * o,
          o = -o + e.height + "px 0px " + (o - t) + "px 0px",
          t = function (e, t) {
        var n = Math.ceil(e / t);var o = [];var r = 1 / n;for (var _e2 = 0; _e2 < n + 1; _e2 += 1) {
          o.push(_e2 * r);
        }return o;
      }(e.height, f);var r = new IntersectionObserver(m, { rootMargin: o, threshold: t });r.observe(e.node), e.observers.progress = r;
    }function w() {
      v(), a.forEach(b), a.forEach(y), l && a.forEach(e);
    }var E = {};return E.setup = function (_ref9) {
      var _ref10, _ref10$;

      var e = _ref9.step,
          t = _ref9.parent,
          _ref9$offset = _ref9.offset,
          n = _ref9$offset === undefined ? .5 : _ref9$offset,
          _ref9$threshold = _ref9.threshold,
          o = _ref9$threshold === undefined ? 4 : _ref9$threshold,
          _ref9$progress = _ref9.progress,
          r = _ref9$progress === undefined ? !1 : _ref9$progress,
          _ref9$once = _ref9.once,
          s = _ref9$once === undefined ? !1 : _ref9$once,
          _ref9$debug = _ref9.debug,
          i = _ref9$debug === undefined ? !1 : _ref9$debug;
      return a = ((_ref10 = [e, t], e = _ref10[0], _ref10$ = _ref10[1], t = _ref10$ === undefined ? document : _ref10$, _ref10), ("string" == typeof e ? Array.from(t.querySelectorAll(e)) : e instanceof Element ? [e] : e instanceof NodeList ? Array.from(e) : e instanceof Array ? e : []).map(function (e, t) {
        return { index: t, direction: void 0, height: e.offsetHeight, node: e, observers: {}, offset: M(e.dataset.offset), top: function (e) {
            var _e$getBoundingClientR = e.getBoundingClientRect(),
                e = _e$getBoundingClientR.top;

            return e + window.pageYOffset - (document.body.clientTop || 0);
          }(e), progress: 0, state: void 0 };
      })), a.length ? (l = r, u = s, p = i, f = Math.max(1, +o), c = M(n), d(), a.forEach(function (e) {
        return e.node.setAttribute("data-scrollama-index", e.index);
      }), h(!0)) : S("no step elements"), E;
    }, E.enable = function () {
      return h(!0), E;
    }, E.disable = function () {
      return h(!1), E;
    }, E.destroy = function () {
      return h(!1), d(), E;
    }, E.resize = function () {
      return w(), E;
    }, E.offset = function (e) {
      return null == e ? c.value : (c = M(e), w(), E);
    }, E.onStepEnter = function (e) {
      return "function" == typeof e ? r.stepEnter = e : S("onStepEnter requires a function"), E;
    }, E.onStepExit = function (e) {
      return "function" == typeof e ? r.stepExit = e : S("onStepExit requires a function"), E;
    }, E.onStepProgress = function (e) {
      return "function" == typeof e ? r.stepProgress = e : S("onStepProgress requires a function"), E;
    }, E;
  };
});
//# sourceMappingURL=scrollama.min.js.map
