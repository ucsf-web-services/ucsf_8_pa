.mag-menu {
  // variable to print .mag-menu
  $block: &;
  // top level menu links, these are used to assign a grid aria to menu li
  $links: latest, features, insights, voices, allissues, trending, collections;

  display: none;
  visibility: hidden;
  width: 100%;
  position: absolute;
  top: 100%;
  left: 0;
  background-color: $c-grey-pale;

  // @include breakpoint($bp-large) {
  //   margin: 0 auto;
  //   max-width: 1280px;
  // }

  ul {
    list-style: none;
  }

  .mag-nav--active & {
    display: block;
    visibility: visible;
  }

  // top level ul
  &__menu {
    display: grid;
    grid-template-areas:
      "latest"
      "features"
      "insights"
      "voices"
      "allissues"
      "trending"
      "collections";

    margin-bottom: 0;
    padding: 0 $page-gutter;
    margin-top: 1.2rem;

    @include breakpoint($bp-medium) {
      grid-template-columns: 1fr 1fr;
      grid-template-rows: repeat(3, min-content) auto auto;
      grid-template-areas:
        "latest   allissues"
        "features allissues"
        "insights allissues"
        "voices allissues"
        "trending trending"
        "collections collections";
    }

    // @include breakpoint($bp-large) {
    //   grid-template-columns: 30% repeat(4, 1fr);
    //   grid-template-rows: min-content auto auto;
    //   grid-template-areas:
    //     "latest features insights voices allissues"
    //     "trending features insights voices allissues"
    //     "collections features insights voices allissues";
    // }

    .universal-header__give-mobile {
      position: relative;
      width: calc(100% + (#{$page-gutter} * 2)); // busting out of the container
      margin-left: -#{$page-gutter}; //aligning to the left
    }

    a.universal-header__give {
      padding-left: $page-gutter;
      padding-right: $page-gutter;
      background-position-x: calc(100% - 15px); // icon needs to be flush with the right edge
      background-size: 38px;
    }
  }

  &__item {
    margin-bottom: 1rem;

    // applying a modifier class and assigning grid area to element with that class
    @each $link in $links {
      &--#{$link} {
        grid-area: #{$link};
      }
    }

    &--allissues {
      margin-bottom: 2rem;
    }

    &--featured {
      margin-bottom: 0;
    }


  }

  &__item:nth-child(4) {
    @include breakpoint($bp-medium) {
      margin-bottom: 4rem;
    }
  }

  &__item:nth-child(5) {
    @include breakpoint($bp-medium) {
      position: relative;
      margin-left: 2rem;
    }

    &::before {
      @include breakpoint($bp-medium) {
        content: "";
        display: block;
        position: absolute;
        height: auto;
        width: 1px;
        border-left: 1px solid #d5d9de;
        top: 1rem;
        bottom: 0;
        left: -2rem;
      }
    }
  }

  &__no-link + .mag-submenu {
    margin-top: 1rem;
  }

  &__link {
    line-height: 32px;
    width: calc(100% - 20px);
    display: flex;
    align-items: center;

    // specificity modification
    #{$block} & {
      color: $c-dark-navy;
    }

    &:hover {
      text-decoration: underline;
    }

    // top level li
    &--alt {
      @include magazine-eyebrow;
      text-decoration: underline;
      text-underline-offset: .3rem;
      margin: 0; // to make link more centered
      line-height: 48px;

      // @include breakpoint($bp-medium) {
      //   margin-bottom: .5rem;
      // }

      &:hover  {
        color: $c-blue-link;

        .icon-home {
          filter: $filter-c-blue-link;
        }
      }
    }
  }

  &__no-link {
    position: relative;
    font-family: $font-helvetica-neue-light;
    font-size: 1.5rem;
    color: $c-dark-navy;
    margin-bottom: 0;
    line-height: 66px;

    &::after {
      content: "";
      display: block;
      border-bottom: 1px solid $c-border-grey-blue;
      transition: width 1s ease-in-out;
    }

    &:hover  {
      color: $c-blue-link;
    }


    #{$block}__item--trending & {
      border-top: 1px solid $c-border-grey-blue;
    }
  }

  .icon-home {
    background-size: 1.5rem;
    width: 1.375rem;
    height: 1.375rem;
    margin-left: .5rem;
  }
}

.mag-nav .slicknav_btn {
  position: relative;
  float: left
}

.menu-item--expanded + .mag-nav__ucsf {
  border-top: 1px solid $c-border-grey-blue;
}
.menu-item--expanded .mag-menu__no-link {
  // border-bottom: none;

  &::after {
    width: 0;
  }
}

// External link
.ext {
  .mag-menu__link--alt & {
    background-size: 15px;
    width: 15px;
    height: 15px;
  }

  .mag-menu__link--alt:hover & {
    background-size: 15px;
  }

  .mag-submenu__link & {
    background-size: 12px;
    width: 12px;
    height: 12px;
  }

  .mag-submenu__link:hover & {
    background-size: 12px;
    background-image: url("/themes/custom/ucsf/assets/images/external-link.svg");
  }

  // Visit UCSF News Center link - Start
  .mag-nav__ucsf-news & {
    @include breakpoint($bp-medium) {
      display: block;
      width: 1rem;
      height: auto;
    }

    @include breakpoint($bp-large) {
      width: 10px;
      background-size: 14px 14px;
      margin-left: .5rem;
      padding-right: 20px;
      filter: brightness(0) invert(1);
    }
  }

  // Needed more specificity
  .mag-nav__ucsf .mag-nav__ucsf-news:hover & {
    @include breakpoint($bp-large) {
      background-size: 14px 14px;
    }
  }

  // link inside menu panel
  .mag-nav__ucsf-news--menu & {
    display: block;
    width: 2rem;
    height: 2rem;
    background-size: 25px 25px;
    padding-right: 45px;
    align-self: center;
  }

  .mag-nav__ucsf-news--menu:hover & {
    filter: $filter-c-blue-link;
    width: 2rem;
    height: 2rem;
    background-size: 25px 25px;
  }

 // Visit UCSF News Center link - End
}

.mag-submenu {
  // variable to print .mag-menu
  $block: &;

  &__menu {
    padding: 0;
  }

  &__link {
    font-family: $font-helvetica-neue-roman;
    font-size: 0.9rem;

    // specificity modification
    #{$block} & {
      color: $c-gulf-blue;
    }

  }

  .mag-menu__item--collections &,
  .mag-menu__item--trending & {
    display: none;
    visibility: hidden;
  }

  .mag-menu__item--active & {
    display: block;
    visibility: visible;
  }
}

.latest-issue {
  display: block;
  padding-bottom: 0;

  &__img {
    margin-top: 24px;
    margin-bottom: 13px;
  }
}